---
import Layout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntryBySlug } from "astro:content";
import { Calendar, User } from "lucide-astro";

// ⭐ Necesario para páginas dinámicas:
export async function getStaticPaths() {
  const posts = await getCollection("blog");
  console.log(posts);

  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;

// Ahora sí, TS entiende que getEntryBySlug("blog") existe
const post = await getEntryBySlug("blog", slug);
if (!post) throw new Error(`Post ${slug} no encontrado`);

const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
  <div class="relative h-64 md:h-96 w-full">
    <img
      src={post.imageUrl}
      alt={post.title}
      class="absolute inset-0 w-full h-full object-cover"
    />
    <div class="absolute inset-0 bg-black/60"></div>
  </div>

  <article class="container mx-auto px-6 py-12 md:py-16">
    <h1>{post.data.title}</h1>
    <p class="text-gray-400 text-sm">{post.data.pubDate.toDateString()}</p>

    <div class="max-w-4xl mx-auto">
      <header class="mb-8 md:mb-12 text-center relative -mt-32 md:-mt-48 z-10">
        <div
          class="max-w-3xl mx-auto bg-dark-card/80 backdrop-blur-sm p-8 rounded-xl"
        >
          <h1
            class="text-3xl md:text-6xl font-extrabold font-family-sans text-foreground mb-4"
          >
            {post.title}
          </h1>
          <div class="flex justify-center items-center space-x-6 text-gray-400">
            <div class="flex items-center space-x-2">
              <User class="w-4 h-4" />
              <span>{post.author}</span>
            </div>
            <div class="flex items-center space-x-2">
              <Calendar class="w-4 h-4" />
              <span>{post.date}</span>
            </div>
          </div>
        </div>
      </header>

      <div
        class="prose prose-invert prose-lg max-w-none prose-p:text-gray-300 prose-headings:text-white prose-strong:text-white prose-blockquote:border-brand-primary prose-blockquote:text-gray-200 prose-a:text-brand-primary prose-ul:list-disc prose-ol:list-decimal"
      >
        <Content />
      </div>

      <div class="mt-12 pt-8 border-t border-dark-border text-center">
        <a
          href="/blog"
          class="text-brand-primary hover:text-brand-secondary font-semibold transition-colors"
        >
          &larr; Volver al Blog
        </a>
      </div>
    </div>
  </article>
</Layout>
