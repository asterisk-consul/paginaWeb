---
import Layout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntry } from "astro:content";
import Calendar from "@/components/icons/Calendar.astro";
import User from "@/components/icons/User.astro";

// ⭐ Necesario para páginas dinámicas:
export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;

// Ahora sí, TS entiende que getEntryBySlug("blog") existe
const post = await getEntry("blog", slug);
if (!post) throw new Error(`Post ${slug} no encontrado`);

const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
  <div class="relative h-64 md:h-96 w-full">
    <img
      src={post.data.imageUrl}
      alt={post.data.title}
      class="absolute inset-0 w-full h-full object-cover"
    />
    <div class="absolute inset-0 bg-black/60"></div>
  </div>

  <article class="container mx-auto px-6 py-12 md:py-16">
    <div class="max-w-4xl mx-auto">
      <header class="mb-8 md:mb-12 text-center relative -mt-32 md:-mt-48 z-10">
        <div
          class="max-w-3xl mx-auto bg-dark-card/80 backdrop-blur-sm p-8 rounded-xl"
        >
          <h1
            class="text-3xl md:text-6xl font-extrabold font-family-sans text-foreground mb-4"
          >
            {post.data.title}
          </h1>
          <div class="flex justify-center items-center space-x-6 text-gray-400">
            <div class="flex items-center space-x-2">
              <User class="w-4 h-4" />
              <span>{post.data.author}</span>
            </div>
            <div class="flex items-center space-x-2">
              <Calendar class="w-4 h-4" />
              <span>
                {
                  new Intl.DateTimeFormat("es-AR", {
                    weekday: "long", // día de la semana
                    day: "2-digit", // día del mes
                    month: "long", // nombre del mes
                    year: "numeric", // año completo
                  }).format(post.data.pubDate)
                }
              </span>
            </div>
          </div>
        </div>
      </header>

      <div class="prose prose-invert prose-lg max-w-none blog-content">
        <Content />
      </div>

      <div class="mt-12 pt-8 border-t border-dark-border text-center">
        <a
          href="/blog"
          class="text-brand-primary hover:text-brand-secondary font-semibold transition-colors"
        >
          &larr; Volver al Blog
        </a>
      </div>
    </div>
  </article>
</Layout>
