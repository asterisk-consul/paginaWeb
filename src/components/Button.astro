---
type CommonProps = {
  class?: string;
  color?: "primary" | "primary-alt";
  size?: "sm" | "md";
  arrow?: boolean;
  title: string;
  revealable?: boolean;
  manualReveal?: boolean;
};

type AnchorProps = {
  url: string;
  target?: string;
  type?: never;
} & CommonProps;

type ButtonProps = {
  url?: never;
  target?: never;
  type?: "button" | "submit" | "reset";
} & CommonProps;

type Props = AnchorProps | ButtonProps;

const {
  title,
  url,
  target,
  class: className = "",
  size = "md",
  type = "button",
  color = "primary",
  arrow = false,
  revealable = true,
  manualReveal = false,
} = Astro.props;

const Element = url ? "a" : "button";

const attrs = Element === "a" ? { href: url, target } : { type };
---

<Element
  {...attrs}
  data-sy-reveal={revealable ? "" : undefined}
  data-sy-reveal-manual={manualReveal ? "" : undefined}
  class:list={[
    "btn relative inline-block overflow-hidden rounded-full font-semibold tracking-wide",
    size === "sm" ? "text-xs" : "text-sm",
    color === "primary" ? "btn-primary" : "btn-primary-alt",
    arrow && "btn-arrow",
    className,
  ]}
>
  <span class="btn-inner relative block">
    <span class="btn-hover absolute inset-0 flex items-center justify-center">
      {title}
    </span>
    <span class="btn-base relative flex items-center justify-center gap-2">
      {title}
    </span>
  </span>
</Element>

<style>
  .btn {
    --bg: hsl(var(--primary));
    --txt: white;
    --hover-bg: white;
    --hover-txt: hsl(var(--primary));
    background: none;
    border: none;
    cursor: pointer;
  }

  .btn-primary {
    --bg: hsl(var(--primary));
    --txt: white;
  }

  .btn-primary-alt {
    --bg: hsl(var(--secondary));
    --txt: hsl(var(--foreground));
  }

  [data-sy-reveal] {
    clip-path: inset(0 100% 0 0 round 9999px);
    transform: translateX(2rem);
    transition: 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }

  [data-sy-reveal].is-in {
    clip-path: inset(0 0 round 9999px);
    transform: translateX(0);
  }

  .btn-inner::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 9999px;
    border: 2px solid var(--bg);
    z-index: 3;
  }

  .btn-base,
  .btn-hover {
    padding: 0.75em 1.5em;
    border-radius: 9999px;
    background: var(--bg);
    color: var(--txt);
    transition: clip-path 0.3s ease;
    line-height: 1.25;
  }

  .btn-hover {
    background: var(--hover-bg);
    color: var(--hover-txt);
    clip-path: inset(50% round 9999px);
    z-index: 2;
  }

  .btn:hover .btn-hover,
  .btn:focus .btn-hover {
    clip-path: inset(-100% round 9999px);
  }

  .btn-arrow .btn-base::after,
  .btn-arrow .btn-hover::after {
    content: "";
    width: 1.25em;
    height: 1.25em;
    background: currentColor;
    mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 21'%3E%3Cpath d='m16 9-6-6 2-1 8 8-1 1-7 7-2-1 6-6H0V9z'/%3E%3C/svg%3E")
      no-repeat center / contain;
  }
</style>
