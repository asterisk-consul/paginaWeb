---
import Button from "./Button.astro";
import type { Link } from "../types";

interface Item {
  title: string;
  price: {
    amount: string;
    duration: string;
  };
  link: Link;
  features: {
    title: string;
    disabled?: boolean;
  }[];
}

interface Props {
  title: string;
  subtitle: string;
  items: [Item, Item];
}

const { title, subtitle, items } = Astro.props;
---

<section class="relative py-20">
  <div class="container mx-auto px-6">
    <!-- Título -->
    <h2
      class="
        text-center
        uppercase
        font-family-tight
        font-regular
        text-4xl md:text-5xl
        tracking-tighter
        mb-2
      "
    >
      {title}
    </h2>

    <p
      class="
        text-center
        text-foreground/70
        max-w-2xl
        mx-auto
        mb-14
      "
    >
      {subtitle}
    </p>

    <!-- Planes -->
    <div
      class="
        flex
        flex-col
        md:flex-row
        gap-8
        justify-center
        items-stretch
      "
      id="pricing-plans"
    >
      {
        items.map((item, i) => (
          <div
            class={`
              pricing-card
              relative
              rounded-2xl
              max-w-sm
              w-full
              cursor-pointer
              transition-all
              duration-300
              ${i === 1 ? "plan-highlight p-[2px]" : "bg-card border border-border"}
            `}
            data-plan-index={i}
          >
            <div
              class="
                bg-card
                rounded-2xl
                p-8
                h-full
                flex
                flex-col
              "
            >
              <!-- Título -->
              <h3
                class="
                  font-family-tight
                  text-lg
                  tracking-tight
                  mb-3
                "
              >
                {item.title}
              </h3>

              <!-- Precio -->
              <div class="flex items-end gap-1 mb-8">
                <span
                  class="
                    font-family-tight
                    text-5xl
                    tracking-tight
                  "
                >
                  {item.price.amount}
                </span>
                <span class="text-sm text-foreground/60 pb-2">
                  /{item.price.duration}
                </span>
              </div>

              <!-- Features -->
              <ul class="flex flex-col gap-3 mb-10">
                {
                  item.features.map((feat) => (
                    <li
                      class={`
                        flex
                        items-start
                        gap-3
                        text-sm
                        ${
                          feat.disabled
                            ? "text-foreground/40"
                            : "text-foreground"
                        }
                      `}
                    >
                      <span
                        class={`
                          mt-1
                          block
                          h-2
                          w-2
                          rounded-full
                          flex-shrink-0
                          ${
                            feat.disabled
                              ? "bg-foreground/30"
                              : "bg-primary"
                          }
                        `}
                      />
                      {feat.title}
                    </li>
                  ))
                }
              </ul>

              <!-- CTA -->
              <div class="mt-auto">
                <Button
                  {...item.link}
                  color={i === 0 ? "primary-alt" : "primary"}
                  class="w-full"
                />
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  @keyframes plan-border {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  @keyframes plan-glow {
    0%, 100% {
      box-shadow: 
        0 0 20px hsla(var(--primary) / 0.3),
        0 0 40px hsla(var(--secondary) / 0.2),
        0 0 60px hsla(var(--primary) / 0.1);
    }
    50% {
      box-shadow: 
        0 0 30px hsla(var(--primary) / 0.5),
        0 0 60px hsla(var(--secondary) / 0.3),
        0 0 90px hsla(var(--primary) / 0.2);
    }
  }

  .plan-highlight {
    position: relative;
    background: hsl(var(--card));
    overflow: hidden;
    animation: plan-glow 3s ease-in-out infinite;
  }

  .plan-highlight::before {
    content: "";
    position: absolute;
    inset: -100%;
    background: conic-gradient(
      from 0deg at 50% 50%,
      hsl(var(--primary)),
      hsl(var(--secondary)),
      hsl(var(--primary))
    );
    animation: plan-border 6s linear infinite;
  }

  .plan-highlight > div {
    position: relative;
    z-index: 1;
  }

  /* Hover suave en cards sin highlight */
  .pricing-card:not(.plan-highlight):hover {
    transform: translateY(-4px);
    box-shadow: 
      0 4px 20px rgba(0, 0, 0, 0.1),
      0 0 15px hsla(var(--primary) / 0.1);
  }
</style>

<script>
  const pricingPlans = document.getElementById('pricing-plans');
  const cards = document.querySelectorAll('.pricing-card');

  if (pricingPlans && cards.length > 0) {
    cards.forEach((card) => {
      card.addEventListener('click', () => {
        // Remover highlight de todas las cards
        cards.forEach((c) => {
          c.classList.remove('plan-highlight', 'p-[2px]');
          c.classList.add('bg-card', 'border', 'border-border');
        });

        // Agregar highlight a la card clickeada
        card.classList.add('plan-highlight', 'p-[2px]');
        card.classList.remove('bg-card', 'border', 'border-border');
      });
    });
  }
</script>